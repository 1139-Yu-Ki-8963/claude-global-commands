---
description: Assistant向けセッション引き継ぎメタプロンプト生成
allowed-tools: ["Bash", "Read", "TodoWrite"]
---

# Assistant向けメタプロンプト生成

**あなたはすでに再起動後の状態です。**

## このコマンドの目的とターゲット

**ターゲット**: 次のClaude Codeセッション（Assistant/AI）
**目的**: 現在のセッションの文脈を次のAssistantに完全に引き継ぐ
**最適化**: 人間ではなくAIが効率的に理解できる構造で情報を整理

次のAssistantが現在のセッションを完全に理解し、適切に作業を継続できるメタプロンプトを生成します。

## Step 1: セッション分析

現在の会話履歴から以下を抽出してください：
1. ユーザーの最初の要求とその背景・意図
2. 実施した作業の流れと各判断の理由
3. 遭遇した問題とその解決過程
4. 現在の状態と残っている作業

## Step 2: 自動情報収集

### セッション情報のログ保存
!echo "=== セッション情報をログに保存中 ==="
!SESSION_ID="${CLAUDE_SESSION_ID:-$(echo $$)}"
!LOG_DIR="$HOME/.claude/logs/$(date +%Y-%m-%d)/${SESSION_ID:0:8}"
!mkdir -p "$LOG_DIR"
!echo ""

### プロジェクト環境
!echo "=== 作業ディレクトリ ==="
!pwd
!echo ""
!echo "=== Gitブランチ ==="
!git branch --show-current 2>/dev/null || echo "Gitリポジトリではありません"
!echo ""
!echo "=== プロジェクト設定（CLAUDE.md） ==="
!head -30 CLAUDE.md 2>/dev/null || echo "CLAUDE.mdなし"

### 変更状況
!echo ""
!echo "=== 変更ファイル一覧 ==="
!git status --short 2>/dev/null || echo "変更なし"
!echo ""
!echo "=== 変更統計 ==="
!git diff --stat 2>/dev/null || echo "差分なし"

### メタ情報をログファイルに記録
!META_LOG="$LOG_DIR/03-meta-commands.jsonl"
!jq -nc --arg ts "$(date -u +%Y-%m-%dT%H:%M:%SZ)" --arg sid "${SESSION_ID:0:8}" --arg cwd "$(pwd)" --arg branch "$(git branch --show-current 2>/dev/null || echo 'none')" --arg project "$(basename $(pwd))" --arg git_status "$(git status --short 2>/dev/null | wc -l | tr -d ' ')" '{"timestamp": $ts, "session_id": $sid, "working_dir": $cwd, "git_branch": $branch, "project": $project, "changed_files": ($git_status | tonumber), "command": "meta"}' >> "$META_LOG" 2>/dev/null && echo "✓ セッション情報をログに保存しました: $META_LOG" || echo "※ ログ保存はスキップされました"

### TodoList確認
TodoListの現在状態を確認し、未完了タスクと優先順位を把握してください。

### プロジェクトメモリ確認
プロジェクト固有の重要な情報やメモがある場合は確認してください。

## Step 3: メタプロンプト生成

上記の分析と収集情報を基に、以下の構造で**Assistantが理解しやすい物語形式**のメタプロンプトを生成してください：

```markdown
# セッション引き継ぎ情報

**このメタプロンプトの読み手**: 次のClaude Codeセッション（Assistant/AI）
**作成者**: 前のセッションのAssistant
**目的**: 作業の完全な文脈を引き継ぎ、ユーザーの意図を理解して継続

前のセッションからの引き継ぎです。以下の文脈を理解して作業を継続してください。

## 作業背景と目的

### 何をしようとしていたか
[ユーザーの最初の要求とその意図を明確に記述]
例: ユーザーは[具体的な要求]を求めていました。これは[背景・理由]のためです。

### なぜそれが必要だったか
[背景にある問題や動機を説明]
例: この作業が必要な理由は[具体的な問題]を解決するためでした。

### どこまで達成したか
[完了した内容と現在の状態を具体的に]
例: 現在、[具体的な成果]まで完了しています。[残りの作業]が未完了です。

## 実施した作業の詳細

### 作成・変更したファイル
[ファイルパス]: [役割と重要な実装内容]
- 作成理由: [なぜこのファイルが必要だったか]
- 主要機能: [何をするファイルか]
- 使用方法: [どのように呼び出すか]

### 遭遇した問題と解決
問題1: [具体的なエラーや課題]
- 原因: [なぜ発生したか]
- 試した解決策: [何を試したか]
- 最終的な解決: [どう解決したか]
- 学習事項: [今後のために覚えておくべきこと]

### 重要な判断とその理由
判断1: [何を決定したか]
- 選択理由: [なぜその選択をしたか]
- 検討した代替案: [他にどんな選択肢があったか]
- この判断の影響: [この決定がもたらす結果]

## 現在のプロジェクト状態

### 環境情報
- 作業ディレクトリ: [パス]
- Gitブランチ: [ブランチ名]
- 変更ファイル: [リスト]
- 重要な依存関係: [MCPツールなど]

### 未解決の課題と対応方針
課題: [内容]
- 影響: [なぜこれが重要か]
- 推奨対応: [どう対処すべきか]
- 優先度: [いつ対応すべきか]

## 作業継続のための指示

### 最初に実行すべきこと
```bash
# このコマンドを最初に実行してください
[具体的なコマンド]
```
実行理由: [なぜこれが最優先なのか]
期待結果: [このコマンドで何が確認/実行されるか]

### その後の作業手順
1. [タスク1]
   - 実行内容: [具体的に何をするか]
   - 期待結果: [どうなれば成功か]
   - 注意点: [気をつけるべきこと]

2. [タスク2]
   - 実行内容: [具体的に何をするか]
   - 期待結果: [どうなれば成功か]

### 作業時の注意事項
- [過去の失敗から学んだ避けるべきこと]
- [プロジェクト固有の制約や規約]
- [ユーザーが特に気にしているポイント]

## 参照すべき重要情報

### プロジェクト固有の設定
- CLAUDE.md: [特に注意すべき設定や規約]
- 関連ファイル: [参照が必要なファイルとその理由]

### ユーザーの最終目標
[ユーザーが最終的に達成したいこと]
成功基準: [何をもって完了とするか]

### 会話の重要な転換点
[いつ]: [何が起きて、どう方針が変わったか]
例: ユーザーから「[指摘内容]」という指摘を受け、[方針変更]しました。

---
このメタプロンプトの情報に基づいて作業を継続してください。判断に迷った場合は、上記の文脈と理由を参照して、ユーザーの意図に沿った選択をしてください。
```

**重要な原則**:
1. すべての判断と行動に「なぜ」を明記する
2. 失敗と成功の両方から学んだことを共有する
3. ユーザーの最終目標を常に意識できるようにする
4. 具体的で実行可能な指示を提供する
5. 文脈を物語として自然に理解できるようにする

$ARGUMENTS