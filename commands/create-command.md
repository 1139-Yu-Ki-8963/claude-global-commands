---
description: カスタムコマンドを対話的に作成する機能
allowed-tools: ["Read", "Write", "Edit", "Bash", "mcp__sequential-thinking__*", "TodoWrite"]
argument-hint: [コマンド名] [説明]
---

# カスタムコマンド作成機能

新しいカスタムコマンドを対話的に作成します。

引数: $ARGUMENTS

## Phase 1: 事前準備（必須）

まず、docs/commands.mdを読み込みます。これは必須処理です。

## Phase 2: ユーザー要求分析

引数から以下を分析します：
- コマンド名
- コマンドの説明
- 想定される用途
- 必要な機能

引数が不足している場合は、対話的に情報を収集します。

## Phase 3: テンプレート選択

以下の5種類のテンプレートから最適なものを選択します：

1. **基本テンプレート**: シンプルなプロンプトコマンド
2. **引数付きテンプレート**: $ARGUMENTS を使用するコマンド
3. **ファイル分析テンプレート**: @$ARGUMENTS + serena連携
4. **Bash実行テンプレート**: !コマンド形式でシェルコマンド実行
5. **思考エージェントテンプレート**: sequential-thinking連携

ユーザーの要求に基づいて最適なテンプレートを提案し、確認を求めます。

## Phase 4: フロントマター生成

選択されたテンプレートに基づいて以下を自動生成します：

- `description`: コマンドの説明
- `allowed-tools`: 必要なツールのリスト
- `argument-hint`: 引数のヒント（引数を使用する場合は必須）

**注意**: `argument-hint`を追加する場合、本文にも`受け取った引数: $ARGUMENTS`の表示セクションを追加してください。

## Phase 5: コマンドファイル作成

以下の手順でファイルを作成します：

1. **重複チェック**: 既存コマンドとの重複確認
2. **ファイル名決定**: 適切なファイル名を生成
3. **配置場所決定**: プロジェクト用 (.claude/commands/) またはグローバル用 (~/.claude/commands/)
4. **標準セクションの生成**: 以下のセクションを含める
5. **ファイル作成**: 生成されたコンテンツでファイルを作成

### 標準セクション構成

作成するコマンドファイルには、以下の標準セクションを含めてください：

#### 1. コマンドタイトル（必須）
```markdown
# [コマンドの説明的なタイトル]
```

#### 2. 引数表示（引数を使用する場合）
```markdown
受け取った引数: $ARGUMENTS
```

#### 3. Prerequisites（前提条件）
コマンド実行前に確認すべき条件をリスト化：
```markdown
## 📋 Prerequisites（前提条件）

- [ ] [PRE-001] [確認項目1]
  - 確認方法：[確認方法]
  - 期待：[期待される状態]
- [ ] [PRE-002] [確認項目2]
  - 確認方法：[確認方法]
  - 期待：[期待される状態]
```

**例:**
- MCP接続確認
- 引数の存在確認
- 必要なツールのインストール確認
- Git設定確認
- ファイル・ディレクトリの存在確認

#### 4. メイン処理（Phase構成）
コマンドの主要な処理フロー

#### 5. TodoWrite使用義務（複雑なコマンドの場合）
```markdown
## TodoWrite使用義務

複雑なタスクの場合、必ずTodoWriteツールでPhase管理を行ってください：

1. **タスク開始時**: 全PhaseをTodoWriteに登録
2. **Phase実行中**: 該当Phaseをin_progressに変更
3. **Phase完了時**: 即座にcompletedに変更
4. **新Phase追加時**: 必要に応じてTodoWriteを更新

詳細は`~/.claude/docs/todowrite-specification.md`を参照。
```

#### 6. Validation（検証項目）
コマンド実行後に確認すべき項目：
```markdown
## ✅ Validation（検証項目）

- [ ] [VAL-001] [検証項目1]
  - 確認方法：[確認方法]
  - 確認内容：[確認内容]
  - 成功条件：[成功条件]
- [ ] [VAL-002] [検証項目2]
  - 確認方法：[確認方法]
  - 確認内容：[確認内容]
  - 成功条件：[成功条件]
```

**例:**
- コミット作成確認
- ファイル作成確認
- Issue作成確認
- ステータス確認

## Phase 6: 動作確認

作成完了後の確認作業：

1. **構文チェック**: フロントマターのYAML構文確認
2. **使用例生成**: 作成されたコマンドの使用例を提示
3. **テスト実行提案**: 実際にコマンドをテストするかの確認

## エラーハンドリング

- ファイル名重複時の代替名提案
- フロントマター構文エラーの自動修正
- ツール制限違反の警告
- セキュリティガイドライン適用

## 完了メッセージ

作成完了時に以下を表示します：
- 作成されたファイルのパス
- コマンドの使用方法
- 推奨する次のステップ

---

## TodoWrite使用義務

複雑なタスクの場合、必ずTodoWriteツールでphase管理を行ってください：

1. **タスク開始時**: 全phaseをTodoWriteに登録
2. **Phase実行中**: 該当phaseをin_progressに変更
3. **Phase完了時**: 即座にcompletedに変更
4. **新Phase追加時**: 必要に応じてTodoWriteを更新

詳細は`~/.claude/docs/todowrite-specification.md`を参照。

---

**重要**: この機能は必ずPhase 1でdocs/commands.mdを読み込み、Phase番号（整数のみ）に従って処理を進行します。
