---
description: Linear MCPでissueを対話的に追加（AI構造化対応）
allowed-tools: ["mcp__linear__*"]
argument-hint: [タスク内容の説明]
---

# Linear Issue自動作成

受け取った引数: $ARGUMENTS

## 📋 Prerequisites（前提条件）

- [ ] [PRE-001] Linear MCP接続確認
  - 確認方法：`/mcp`コマンドで認証済み
  - 期待：Linear MCPサーバーに接続できている
- [ ] [PRE-002] 引数の存在確認
  - 確認内容：タスク内容が引数として渡されている
  - 期待：引数が空でないこと
- [ ] [PRE-003] Team存在確認
  - コマンド：`mcp__linear__list_teams`
  - 期待：1つ以上のTeamが取得できる

# Phase 1: Team選択

## Team一覧取得
Linear workspaceの全Teamを取得してください。

## Team選択
取得したTeamを番号付きリストで表示し、ユーザーに番号で選択させてください。

例:
```
利用可能なTeam:
1. AIDD
2. private

番号を入力してください:
```

# Phase 2: タスク内容の分析とテンプレート提案

## コマンド引数の受け取り
コマンド実行時の引数からタスク内容を受け取ってください。
引数がない場合はエラーを返してください。

## テンプレートの自動判断
受け取った内容を分析し、最も適切なテンプレートを判断してください。

判断基準:
- 「バグ」「エラー」「動かない」「直す」→ Bug修正
- 「追加」「実装」「新規」「機能」→ 新機能開発
- 「調査」「検証」「確認」「調べる」→ 調査・検証
- 「ドキュメント」「README」「手順書」「説明」→ ドキュメント作成
- その他 → 汎用タスク

## テンプレート別の構造化

判断したテンプレートに従って、タスク内容を構造化してください。

### 1. Bug修正テンプレート
```markdown
## 現象
[ユーザー入力から抽出]

## 再現手順
[推測される手順をリスト化]

## 期待される動作
[本来あるべき動作を記述]

## 実際の動作
[実際に起きている動作を記述]

## 影響範囲
[推測される影響範囲]

## 原因（判明している場合）
[入力に原因があれば記載、なければ「調査中」]

## 修正方針
[推測される修正方針]
```

### 2. 新機能開発テンプレート
```markdown
## 機能概要
[ユーザー入力から抽出した機能の説明]

## 背景・目的
[推測される背景・目的]

## 要件
- [推測される要件1]
- [推測される要件2]

## 実装方針
[推測される技術的アプローチ]

## 完了条件
- [ ] [条件1]
- [ ] [条件2]
```

### 3. 調査・検証タスクテンプレート
```markdown
## 調査目的
[ユーザー入力から抽出]

## 調査内容
[具体的な調査内容]

## 調査範囲
[推測される範囲]

## 期待される成果物
- [成果物1]

## 期限
未定
```

### 4. ドキュメント作成テンプレート
```markdown
## ドキュメント種類
[ユーザー入力から推測]

## 対象読者
[推測される読者]

## 記載内容
[書くべき内容]

## 参照リソース
[関連情報があれば記載]
```

### 5. 汎用タスクテンプレート
```markdown
## タスク内容
[ユーザー入力の内容]

## 目的
[推測される目的]

## 完了条件
- [ ] [条件1]
```

## タイトル生成
構造化した内容から簡潔で分かりやすいタイトルを生成してください。

形式: 「[動詞] + [対象] + [内容]」
例:
- 「ログインボタンが動作しないバグを修正」
- 「ユーザー管理機能を実装」
- 「API性能を調査」

## 提示とテンプレート選択

生成した内容をユーザーに提示し、テンプレートの確認を求めてください:

```
受け取ったタスク内容:
[コマンド引数の内容]

推奨テンプレート: [テンプレート名]

以下の内容でIssueを作成します:

**Title**: [生成されたタイトル]

**Description**:
[構造化されたDescription]

---

このテンプレートで良いですか？別のテンプレートを選択する場合は番号を入力してください:

1. このまま進む ← 推奨
2. Bug修正
3. 新機能開発
4. 調査・検証
5. ドキュメント作成
6. 汎用タスク

番号を入力:
```

## テンプレート再選択の処理

- **1が入力された場合**: Phase 3へ進む
- **2〜6が入力された場合**:
  - 選択されたテンプレートで再構造化
  - タイトルとDescriptionを再生成
  - 再度提示（上記のフォーマットで）
  - この処理を1が入力されるまで繰り返す

# Phase 3: タスク分割の確認

## 分割可能性の判断
Phase 2で受け取ったタスク内容を分析し、親子タスクとして分割すべきか判断してください。

**分割推奨の基準:**
- 複数の独立した作業が含まれている（例：「AとBを作成」）
- 箇条書きで複数の異なる機能・タスクがリストされている
- 「〜を作成」「〜を実装」が2つ以上ある

**分割不要の基準:**
- 単一の機能・バグ修正
- 1つの調査タスク
- 明確に単一の作業単位

## ユーザーへの確認

分割可能と判断した場合、以下のように提案してください:

```
このタスクは以下のように分割できます:

親タスク: [全体を表すタイトル]
├─ 子タスク1: [サブタスク1のタイトル]
├─ 子タスク2: [サブタスク2のタイトル]
└─ 子タスク3: [サブタスク3のタイトル] ※必要に応じて

親子タスクとして作成しますか？
y: はい（親1つ + 子N個を作成）← 推奨
n: いいえ（単一タスクとして作成）

(y/n):
```

分割不要と判断した場合は、この確認をスキップしてPhase 4へ進んでください。

## 親子タスクの構造化

「y」を選択した場合:
- 親タスクのタイトルとDescriptionを生成
- 各子タスクのタイトルとDescriptionを生成
- それぞれPhase 2で選択されたテンプレートに従って構造化

「n」を選択した場合:
- Phase 2で生成した単一のIssue内容を使用

# Phase 4: ステータス選択

## Phase 3で親子タスクを選択した場合
ユーザーに以下の選択肢を提示してください:

```
Issueのステータス設定を選択してください:

推奨設定:
- 親タスク: Backlog（進捗管理用）
- 子タスク: TODO（即座に着手可能）

1: 推奨設定を使用 ← おすすめ
2: 全てBacklog
3: 全てTODO
4: 個別に指定

(1-4):
```

選択4の場合、親タスクと各子タスクのステータスを個別に確認してください。

## Phase 3で単一タスクを選択した場合、または分割不要と判断された場合
ユーザーに以下の選択肢を提示してください:

```
このIssueのステータスを選択してください:

1: Backlog（優先順位未確定、後で対応）
2: TODO（次に着手する）← デフォルト
3: その他を指定

(1-3):
```

選択3の場合、利用可能なステータス一覧を`list_issue_statuses`で取得して選択させてください。

# Phase 5: Issue作成

## Issue作成実行
Linear MCPの`create_issue`を使用してIssueを作成してください。

パラメータ:
- team: Phase 1で選択されたTeam名またはID
- title: Phase 2で生成されたタイトル（Phase 3で親子分割した場合は各タスクのタイトル）
- description: Phase 2で構造化されたDescription（Phase 3で親子分割した場合は各タスクのDescription）
- state: Phase 4で選択されたステータス（親子タスクの場合は、それぞれに応じたステータス）

**重要**: Phase 3で親子タスクとして作成する場合、親Issueを先に作成し、そのIDを使って子Issueを`parentId`パラメータ付きで作成してください。各Issueには適切なステータスを設定してください。

## 完了報告
作成されたIssueの情報を表示してください:

```
✅ Issueを作成しました！

- ID: [AIDD-XX]
- Title: [タイトル]
- URL: [IssueのURL]
```

## TodoWrite使用義務

複雑なタスクの場合、必ずTodoWriteツールでPhase管理を行ってください：

1. **タスク開始時**: 全PhaseをTodoWriteに登録
2. **Phase実行中**: 該当Phaseをin_progressに変更
3. **Phase完了時**: 即座にcompletedに変更
4. **新Phase追加時**: 必要に応じてTodoWriteを更新

詳細は`~/.claude/docs/todowrite-specification.md`を参照。

## ✅ Validation（検証項目）

- [ ] [VAL-001] Issue作成確認
  - 確認方法：返却されたIssue IDとURLを確認
  - 確認内容：Linear上でIssueが存在することを確認
  - 成功条件：指定したTeamにIssueが作成されている
- [ ] [VAL-002] ステータス確認
  - 確認内容：選択したステータスが正しく設定されている
  - 成功条件：Phase 4で選択したステータスと一致
- [ ] [VAL-003] 親子関係確認（親子タスクの場合）
  - 確認方法：子IssueのparentIdを確認
  - 確認内容：子Issueが親Issueに紐付いている
  - 成功条件：全ての子Issueが正しい親IDを持つ
