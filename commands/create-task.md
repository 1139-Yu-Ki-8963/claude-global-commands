---
description: コード分析からLinearタスク自動作成
allowed-tools: ["Read", "Grep", "mcp__serena__*", "mcp__linear__*"]
argument-hint: [改善要件の説明]
---

# Linear Task自動作成

受け取った引数: $ARGUMENTS

## 📋 Prerequisites（前提条件）

- [ ] [PRE-001] Linear MCP接続確認
  - 確認方法: `/mcp`コマンドで認証済み
  - 期待: Linear MCPサーバーに接続できている
- [ ] [PRE-002] serena MCP接続確認
  - 確認方法: コードベースのシンボル検索が可能
  - 期待: serena MCPが正常に動作している
- [ ] [PRE-003] 引数の存在確認
  - 確認内容: 改善要件が引数として渡されている
  - 期待: 引数が空でないこと

# Phase 1: Team選択

## Team一覧取得
Linear workspaceの全Teamを取得してください。

## Team選択
取得したTeamを番号付きリストで表示し、ユーザーに番号で選択させてください。

例:
```
利用可能なTeam:
1. AIDD
2. private

番号を入力してください:
```

# Phase 2: コードベース分析

## 要件の解釈
受け取った引数（`$ARGUMENTS`）から以下を特定してください:
- 改善対象の種類（長大メソッド、重複ロジック、命名改善、etc.）
- キーワード（関数名、ファイル名など）

## 該当コードの特定

### ステップ1: ファイル検索
キーワードに基づいて該当ファイルを検索してください。

使用ツール:
- `mcp__serena__find_file`: ファイル名検索
- `mcp__serena__search_for_pattern`: コード内容検索

### ステップ2: シンボル分析
特定したファイル内のシンボル（関数、クラス等）を取得してください。

使用ツール:
- `mcp__serena__get_symbols_overview`: ファイル全体のシンボル構造取得
- `mcp__serena__find_symbol`: 特定シンボルの詳細取得（`include_body=True`で実装も取得）

### ステップ3: 問題箇所の詳細分析
取得したコードを分析し、以下を特定してください:
- 具体的な問題点（長大メソッド、重複、etc.）
- 行番号範囲
- 影響範囲

## 分析結果の構造化
以下の形式で分析結果を整理してください:

```markdown
## 対象ファイル
[ファイルパス]

## 対象関数/クラス
[シンボル名] ([ファイルパス]:[開始行]-[終了行])

## 問題点
1. **[問題種別1]**
   - 詳細: [具体的な説明]
   - コード箇所: [ファイルパス]:[行番号]
2. **[問題種別2]**
   - 詳細: [具体的な説明]
   - コード箇所: [ファイルパス]:[行番号]
```

# Phase 3: タスク内容の生成

## タイトル生成
分析結果から簡潔で具体的なタイトルを生成してください。

形式: `[関数/クラス名]の[問題種別]をリファクタリング`

例:
- `RegisterUser関数の長大メソッドを適切なサイズに分割`
- `RegisterUser関数の重複処理リファクタリング`

## Description生成

以下の構造でDescriptionを生成してください:

```markdown
## 背景

現在の[ファイル名]の[関数名]関数（[ファイルパス]:[行番号]-[行番号]）では、以下の問題が発生している：

1. **[具体的問題1]**
   - [詳細説明とコード箇所]
2. **[具体的問題2]**
   - [詳細説明とコード箇所]

この問題により、コードの保守性・可読性・テスタビリティが低下している。

## ゴール

[関数名]関数を以下の観点でリファクタリングする：
- [具体的な改善目標1]
- [具体的な改善目標2]
- [具体的な改善目標3]

## 受入基準

- [ ] [具体的な実装完了条件1]
- [ ] [具体的な実装完了条件2]
- [ ] [具体的な実装完了条件3]
- [ ] 既存の機能・エラーメッセージが正常に動作
- [ ] [テスト・ビルドの動作確認]

## 詳細コード箇所

### 問題箇所1: [問題名]

```[言語]
// [ファイルパス]:[行番号]-[行番号]
[該当するコード抜粋]
```

### 問題箇所2: [問題名]

```[言語]
// [ファイルパス]:[行番号]-[行番号]
[該当するコード抜粋]
```
```

## ユーザーへの提示と確認
生成した内容をユーザーに提示してください:

```
以下の内容でLinear Issueを作成します:

**Title**: [生成されたタイトル]

**Description**:
[構造化されたDescription]

---

この内容で作成しますか？
y: はい（Issueを作成）
n: いいえ（キャンセル）

(y/n):
```

# Phase 4: ステータス選択

ユーザーに以下の選択肢を提示してください:

```
このIssueのステータスを選択してください:

1: Backlog（優先順位未確定、後で対応）
2: TODO（次に着手する）← デフォルト
3: In Progress（現在作業中）
4: その他を指定

(1-4):
```

選択4の場合、利用可能なステータス一覧を`mcp__linear__list_issue_statuses`で取得して選択させてください。

# Phase 5: Issue作成

## Issue作成実行
Linear MCPの`mcp__linear__create_issue`を使用してIssueを作成してください。

パラメータ:
- team: Phase 1で選択されたTeam名またはID
- title: Phase 3で生成されたタイトル
- description: Phase 3で構造化されたDescription
- state: Phase 4で選択されたステータス

## 完了報告
作成されたIssueの情報を表示してください:

```
✅ Issueを作成しました！

- ID: [TEAM-XX]
- Title: [タイトル]
- URL: [IssueのURL]
- Status: [ステータス]
```

## TodoWrite使用義務

複雑なタスクの場合、必ずTodoWriteツールでPhase管理を行ってください：

1. **タスク開始時**: 全PhaseをTodoWriteに登録
2. **Phase実行中**: 該当Phaseをin_progressに変更
3. **Phase完了時**: 即座にcompletedに変更
4. **新Phase追加時**: 必要に応じてTodoWriteを更新

詳細は`~/.claude/docs/todowrite-specification.md`を参照。

## ✅ Validation（検証項目）

- [ ] [VAL-001] コードベース分析完了確認
  - 確認方法: Phase 2の分析結果を確認
  - 確認内容: 該当コードが正しく特定されている
  - 成功条件: ファイルパス・行番号・問題点が明確
- [ ] [VAL-002] タスク構造化確認
  - 確認方法: Phase 3の生成内容を確認
  - 確認内容: 背景・ゴール・受入基準・詳細が適切
  - 成功条件: リファクタリングに必要な情報が網羅されている
- [ ] [VAL-003] Issue作成確認
  - 確認方法: 返却されたIssue IDとURLを確認
  - 確認内容: Linear上でIssueが存在することを確認
  - 成功条件: 指定したTeamにIssueが作成されている
- [ ] [VAL-004] ステータス確認
  - 確認内容: 選択したステータスが正しく設定されている
  - 成功条件: Phase 4で選択したステータスと一致
